<?php


namespace AdminController;


use Lib\Helper;
use Model\Post;

class PostController extends AdminController
{
    public function index($page){
        $postBD = new Post();
        $page = $page ? $page : 1;
        $posts = $postBD->getPostsList($page,'/dashboard/post');
        foreach ($posts['items'] as $key => $val){
            $disLike = $postBD->getDisLike($posts['items'][$key]['id']);
            $posts['items'][$key]['postLike'] =  $posts['items'][$key]['postLike'] - $disLike['dis'];
        }
        $this->index = $this->app->view()->fetch('dashboard/posts.tpl.php', [
            'posts' => $posts,
            'helper' => Helper::getInstance(),
            'uri' => $this->getUri(),
        ]);

        $this->display();

    }

    public function add(){
        $this->index = $this->app->view()->fetch('dashboard/addPost.tpl.php');
        $this->display();
    }

    protected function display(){
        $this->main = $this->index;
        parent::display(); // TODO: Change the autogenerated stub
    }

    public function searchAjax(){
      $postDB = new Post();
      $posts = $postDB->searchPostsList($_POST['title']);
        foreach ($posts as $key => $val){
            $disLike = $postDB->getDisLike($posts[$key]['id']);
            $posts[$key]['postLike'] =  $posts[$key]['postLike'] - $disLike['dis'];
        }
        $result = '';
        foreach ($posts as $post){
            $result .= $this->app->view()->fetch('dashboard/table.tpl.php', [
                'post' => $post,
                'helper' => Helper::getInstance(),
                'uri' => $this->getUri(),
            ]);
        }
        echo $result;
        exit();

    }

    public function edit($post){
        $postDB = new Post();
        $post = $postDB->getPost();
        $this->index = $this->app->view()->fetch('dashboard/addPost.tpl.php');
        $this->display();
    }
}