<?php


namespace Controller;
use Lib\Helper;
use Lib\Migration;
use Model\Anime;
use Model\Cat;
use Model\Post;
use Model\Product;
use Model\Rating;
use function Composer\Autoload\includeFile;

defined('_Sdef') or exit();

class IndexController extends DisplayController
{
    protected $page;
    public function execute($param = [])
    {

        return $this->display();
    }

    protected function display()
    {
        $productDB = new Product();
        $postDB = new Post();
        $cat = new Cat();
        $anime = new Anime();
        $products = $productDB->getProduct(5);
        $this->title .= 'Таджикский аниме портал !';
        $posts =  $postDB->getPostL10('anime',10);

        foreach ($posts as $key => $val) {
            $posts[$key]['cats'] = $cat->getCatPostL2($posts[$key]['id']);
            $posts[$key]['seria'] = $anime->lastAddSeria($posts[$key]['title'],$posts[$key]['id_tv']);
        }

        $newPosts = $postDB->getPostL5();
        foreach ($newPosts as $key => $val){
            $newPosts[$key]['cats'] = $cat->getCatPostL2($newPosts[$key]['id']);
        }
        $dorams =  $postDB->getPostL10('dorams',5);
        foreach ($dorams as $key => $val){
            $dorams[$key]['cats'] = $cat->getCatPostL2($dorams[$key]['id']);
            $dorams[$key]['seria'] = $anime->lastAddSeria($dorams[$key]['title'],$val['id_tv']);
        }
        $articles =  $postDB->getPostL10('articles',6);
        $search = $this->getSearch();
        $slider = $this->getSlider();
        $this->main = $this->app->view()->fetch('indexbar.tpl.php',[
            'app' => $this->app,
            'uri' => $this->uri,
            'posts' => $posts,
            'helper' => Helper::getInstance(),
            'newPosts' => $newPosts,
            'dorams' => $dorams,
            'articles' => $articles,
            'slider' => $slider,
            'search' => $search,
            'products' => $products


        ]);
        parent::display(); // TODO: Change the autogenerated stub
    }

}